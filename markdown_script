---
title: "Quarterly output manipulation National Accounts"
author: "Rendell E . de Kort"
date: "January 31, 2019"
output: word_document
---

```{r v}
data1<-read.csv("Q_NO_DENTON.csv")
data2<-read.csv("Q_DENTON.csv")
stavaza<-read.csv("stavazaR.csv")
```

## About this file

This is an explanatory note for the steps to convert quarterly output information obtained through the "Herbynization", "quarterly estimation" and "quarterly exceptions" file.

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.



## Reading in the data (not working in the Shiny code)
Data should be in "Comma Seperated Values" (csv.) format to be loaded in and saved in the folder that is consistent with the Working Directory of th R session.


Load the dplyr package and transform the data into a tbl_df format and merge.

```{r a}
library(dplyr)
data1                  <- tbl_df(data1)
data2                  <- tbl_df(data2)
databind               <- bind_rows(data1,data2)
rm(data1)
rm(data2)
```

Filtering data to contain the sections that we are interested seperatly


```{r b}
Nominal_Q              <- filter(databind,databind$Description=="Nominal VA")
Nominal_Q$Description  <- NULL

Real_Q                 <- filter(databind,databind$Description=="Real VA")
Real_Q$Description     <- NULL

Nominal_Y              <- filter(databind,databind$Description=="B nominal")
Nominal_Y$Description  <- NULL

Real_Y                 <- filter(databind,databind$Description=="B Real")
Real_Y$Description     <- NULL

Deflator               <- filter(databind,databind$Description=="Deflator")
Deflator$Description   <- NULL

rm(databind)

# Deflator
Deflator.2013 <- filter(Deflator,Deflator$Period=="2013")
Deflator.2013$Y_2013 <- Deflator.2013$Value
Deflator.2013$Value <- NULL
Deflator.2013$Period <- NULL

Deflator.2014 <- filter(Deflator,Deflator$Period=="2014")
Deflator.2014$Y_2014 <- Deflator.2014$Value
Deflator.2014$Value <- NULL
Deflator.2014$Period <- NULL

Deflator.2015 <- filter(Deflator,Deflator$Period=="2015")
Deflator.2015$Y_2015 <- Deflator.2015$Value
Deflator.2015$Value <- NULL
Deflator.2015$Period <- NULL

Deflator.2016 <- filter(Deflator,Deflator$Period=="2016")
Deflator.2016$Y_2016 <- Deflator.2016$Value
Deflator.2016$Value <- NULL
Deflator.2016$Period <- NULL

Deflator.2017 <- filter(Deflator,Deflator$Period=="2017")
Deflator.2017$Y_2017 <- Deflator.2017$Value
Deflator.2017$Value <- NULL
Deflator.2017$Period <- NULL

#Needs to be continued

```

Creating a check to verify whether the year figures are consistent with Stavaza
```{r c}
Check.Nominal.Y.2013   <-filter(Nominal_Y,Period=="2013")

as.character(stavaza$Werk.ISIC)
 
stavaza                <- select(stavaza,
                           c(Werk.ISIC,B1.g,TAB.CAT,TAB.CAT_DESCRIPTION,ISIC_DESCRIPTION))

Check.Nominal.Y.2013   <- select(Check.Nominal.Y.2013,c(STATID,Value))

Test.equality          <- left_join(stavaza,Check.Nominal.Y.2013,
                   by=c("Werk.ISIC"="STATID"))

rm(Check.Nominal.Y.2013)

Test.equality$Check    <-Test.equality$Value==Test.equality$B1.g

Test.equality          <- Test.equality[,c(1,3,4,5,2,6,7)]

rm(stavaza)

```

Convert from long form to wide format
```{r d}
library(tidyr)
Deflator   <-spread(Deflator,STATID,Value)
Nominal_Q  <-spread(Nominal_Q,STATID,Value)
Nominal_Y  <-spread(Nominal_Y,STATID,Value)
Real_Q     <-spread(Real_Q,STATID,Value)
Real_Y     <-spread(Real_Y,STATID,Value)

Deflator$Period <- c(2013,2014,2015,2016,2017)
Real_Y$Period <- c(2013,2014,2015,2016,2017)
Nominal_Y$Period <- c(2013,2014,2015,2016,2017)

```
